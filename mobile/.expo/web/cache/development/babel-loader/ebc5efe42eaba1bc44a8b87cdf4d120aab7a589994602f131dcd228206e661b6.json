{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useState, useEffect, createElement } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-paper/lib/module/components/Typography/Text\";\nimport Button from \"react-native-paper/lib/module/components/Button/Button\";\nimport TextInput from \"react-native-paper/lib/module/components/TextInput/TextInput\";\nimport { useTheme } from \"react-native-paper/lib/module/core/theming\";\nimport Menu from \"react-native-paper/lib/module/components/Menu/Menu\";\nimport TouchableRipple from \"react-native-paper/lib/module/components/TouchableRipple/TouchableRipple\";\nimport ActivityIndicator from \"react-native-paper/lib/module/components/ActivityIndicator\";\nimport Banner from \"react-native-paper/lib/module/components/Banner\";\nimport ProgressBar from \"react-native-paper/lib/module/components/ProgressBar\";\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport DateTimePicker from '@react-native-community/datetimepicker';\nimport { MaterialCommunityIcons } from '@expo/vector-icons';\nimport dayjs from 'dayjs';\nimport { useNavigation } from '@react-navigation/native';\nimport { appointmentService } from \"../services/appointment.service\";\nimport { patientService } from \"../services/patient.service\";\nimport { useAuthStore } from \"../stores/authStore\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default function BookingScreen() {\n  var _myPatientProfile$use;\n  var theme = useTheme();\n  var navigation = useNavigation();\n  var queryClient = useQueryClient();\n  var _useAuthStore = useAuthStore(),\n    user = _useAuthStore.user;\n  var _useQuery = useQuery({\n      queryKey: ['my-patient-profile', user == null ? void 0 : user.id],\n      queryFn: function () {\n        var _queryFn = _asyncToGenerator(function* () {\n          var _patient, _res$data;\n          if (user != null && (_patient = user.patient) != null && _patient.id) return user.patient;\n          var res = yield patientService.getPatients({\n            limit: 1000\n          });\n          var found = (_res$data = res.data) == null ? void 0 : _res$data.find(function (p) {\n            var _p$user;\n            return p.user_id === (user == null ? void 0 : user.id) || ((_p$user = p.user) == null ? void 0 : _p$user.id) === (user == null ? void 0 : user.id);\n          });\n          if (!found) throw new Error('NOT_FOUND');\n          return found;\n        });\n        function queryFn() {\n          return _queryFn.apply(this, arguments);\n        }\n        return queryFn;\n      }(),\n      enabled: !!(user != null && user.id),\n      retry: 1\n    }),\n    myPatientProfile = _useQuery.data,\n    isLoadingProfile = _useQuery.isLoading,\n    isProfileError = _useQuery.isError;\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    selectedBranch = _useState2[0],\n    setSelectedBranch = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedSpecialty = _useState4[0],\n    setSelectedSpecialty = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    selectedDoctor = _useState6[0],\n    setSelectedDoctor = _useState6[1];\n  var _useState7 = useState(new Date()),\n    _useState8 = _slicedToArray(_useState7, 2),\n    date = _useState8[0],\n    setDate = _useState8[1];\n  var _useState9 = useState(false),\n    _useState0 = _slicedToArray(_useState9, 2),\n    showDatePicker = _useState0[0],\n    setShowDatePicker = _useState0[1];\n  var _useState1 = useState(''),\n    _useState10 = _slicedToArray(_useState1, 2),\n    selectedTimeSlot = _useState10[0],\n    setSelectedTimeSlot = _useState10[1];\n  var _useState11 = useState(''),\n    _useState12 = _slicedToArray(_useState11, 2),\n    notes = _useState12[0],\n    setNotes = _useState12[1];\n  var _useState13 = useState({\n      branch: false,\n      specialty: false,\n      doctor: false\n    }),\n    _useState14 = _slicedToArray(_useState13, 2),\n    visibleMenu = _useState14[0],\n    setVisibleMenu = _useState14[1];\n  var _useQuery2 = useQuery({\n      queryKey: ['branches'],\n      queryFn: appointmentService.getBranches\n    }),\n    _useQuery2$data = _useQuery2.data,\n    branches = _useQuery2$data === void 0 ? [] : _useQuery2$data;\n  var _useQuery3 = useQuery({\n      queryKey: ['specialties'],\n      queryFn: appointmentService.getSpecialties\n    }),\n    _useQuery3$data = _useQuery3.data,\n    specialties = _useQuery3$data === void 0 ? [] : _useQuery3$data;\n  var _useQuery4 = useQuery({\n      queryKey: ['doctors', selectedBranch, selectedSpecialty],\n      queryFn: function queryFn() {\n        return appointmentService.getDoctors(selectedBranch, selectedSpecialty);\n      },\n      enabled: !!selectedSpecialty\n    }),\n    _useQuery4$data = _useQuery4.data,\n    doctors = _useQuery4$data === void 0 ? [] : _useQuery4$data;\n  var formattedDate = dayjs(date).format('YYYY-MM-DD');\n  var _useQuery5 = useQuery({\n      queryKey: ['slots', selectedBranch, selectedSpecialty, selectedDoctor, formattedDate],\n      queryFn: function queryFn() {\n        return appointmentService.getAvailableSlots(selectedBranch, selectedSpecialty, formattedDate, selectedDoctor);\n      },\n      enabled: !!selectedBranch && !!selectedSpecialty,\n      retry: false\n    }),\n    _useQuery5$data = _useQuery5.data,\n    availableSlots = _useQuery5$data === void 0 ? [] : _useQuery5$data,\n    loadingSlots = _useQuery5.isFetching,\n    slotError = _useQuery5.error;\n  useEffect(function () {\n    setSelectedSpecialty('');\n    setSelectedDoctor('');\n    setSelectedTimeSlot('');\n  }, [selectedBranch]);\n  useEffect(function () {\n    setSelectedDoctor('');\n    setSelectedTimeSlot('');\n  }, [selectedSpecialty]);\n  useEffect(function () {\n    setSelectedTimeSlot('');\n  }, [selectedDoctor, formattedDate]);\n  var createMutation = useMutation({\n    mutationFn: appointmentService.createAppointment,\n    onSuccess: function onSuccess() {\n      Alert.alert('Thành công', 'Đặt lịch khám thành công!');\n      queryClient.invalidateQueries(['myAppointments']);\n      navigation.navigate('Appointments');\n    },\n    onError: function onError(err) {\n      var _err$response, _err$response$data;\n      var msg = (err == null ? void 0 : (_err$response = err.response) == null ? void 0 : (_err$response$data = _err$response.data) == null ? void 0 : _err$response$data.message) || 'Đặt lịch thất bại';\n      Alert.alert('Lỗi', Array.isArray(msg) ? msg[0] : msg);\n    }\n  });\n  var handleSubmit = function handleSubmit() {\n    if (!selectedBranch) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Cơ sở');\n    if (!selectedSpecialty) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Chuyên khoa');\n    if (!selectedTimeSlot) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Giờ khám');\n    if (!notes.trim()) return Alert.alert('Thiếu thông tin', 'Vui lòng nhập Triệu chứng');\n    var _selectedTimeSlot$spl = selectedTimeSlot.split(':'),\n      _selectedTimeSlot$spl2 = _slicedToArray(_selectedTimeSlot$spl, 2),\n      h = _selectedTimeSlot$spl2[0],\n      m = _selectedTimeSlot$spl2[1];\n    var startDateTime = dayjs(date).hour(Number(h)).minute(Number(m)).second(0);\n    var endDateTime = startDateTime.add(30, 'minute');\n    createMutation.mutate({\n      patient_id: myPatientProfile.id,\n      branch_id: selectedBranch,\n      doctor_assigned_id: selectedDoctor || undefined,\n      start_time: startDateTime.toISOString(),\n      end_time: endDateTime.toISOString(),\n      appointment_type: 'checkup',\n      notes: notes,\n      source: 'mobile_app'\n    });\n  };\n  var getBranchName = function getBranchName() {\n    var _branches$find;\n    return Array.isArray(branches) ? ((_branches$find = branches.find(function (b) {\n      return b.id === selectedBranch;\n    })) == null ? void 0 : _branches$find.name) || 'Chọn cơ sở' : 'Chọn cơ sở';\n  };\n  var getSpecialtyName = function getSpecialtyName() {\n    var _specialties$find;\n    return Array.isArray(specialties) ? ((_specialties$find = specialties.find(function (s) {\n      return s.id === selectedSpecialty;\n    })) == null ? void 0 : _specialties$find.name) || 'Tất cả chuyên khoa' : 'Tất cả chuyên khoa';\n  };\n  var getDoctorName = function getDoctorName() {\n    var _doctors$find, _doctors$find$user;\n    if (!selectedDoctor) return 'Bác sĩ trong khoa này (Bất kỳ)';\n    return Array.isArray(doctors) ? (_doctors$find = doctors.find(function (d) {\n      return d.id === selectedDoctor;\n    })) == null ? void 0 : (_doctors$find$user = _doctors$find.user) == null ? void 0 : _doctors$find$user.full_name : 'Chọn bác sĩ';\n  };\n  if (isLoadingProfile) return _jsx(View, {\n    style: styles.center,\n    children: _jsx(ActivityIndicator, {\n      animating: true,\n      size: \"large\"\n    })\n  });\n  if (isProfileError || !myPatientProfile) return _jsx(View, {\n    style: {\n      padding: 16\n    },\n    children: _jsx(Banner, {\n      visible: true,\n      actions: [{\n        label: 'Cập nhật',\n        onPress: function onPress() {\n          return navigation.navigate('Profile');\n        }\n      }],\n      children: \"Ch\\u01B0a c\\xF3 h\\u1ED3 s\\u01A1 b\\u1EC7nh nh\\xE2n.\"\n    })\n  });\n  return _jsx(KeyboardAvoidingView, {\n    behavior: Platform.OS === 'ios' ? 'padding' : undefined,\n    style: {\n      flex: 1\n    },\n    children: _jsxs(ScrollView, {\n      style: styles.container,\n      contentContainerStyle: {\n        paddingBottom: 40\n      },\n      children: [_jsxs(View, {\n        style: styles.header,\n        children: [_jsxs(Text, {\n          variant: \"titleMedium\",\n          style: {\n            fontWeight: 'bold',\n            color: theme.colors.primary\n          },\n          children: [\"\\u0110\\u1EB7t l\\u1ECBch: \", (_myPatientProfile$use = myPatientProfile.user) == null ? void 0 : _myPatientProfile$use.full_name]\n        }), _jsx(ProgressBar, {\n          progress: selectedTimeSlot ? 1 : 0.6,\n          color: theme.colors.primary,\n          style: {\n            marginTop: 8,\n            height: 4,\n            borderRadius: 2\n          }\n        })]\n      }), _jsxs(View, {\n        style: styles.formContainer,\n        children: [_jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"C\\u01A1 s\\u1EDF kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(Menu, {\n            visible: visibleMenu.branch,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                branch: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  branch: true\n                }));\n              },\n              style: styles.dropdown,\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: getBranchName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: Array.isArray(branches) && branches.map(function (b) {\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedBranch(b.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    branch: false\n                  }));\n                },\n                title: b.name\n              }, b.id);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Chuy\\xEAn khoa \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(Menu, {\n            visible: visibleMenu.specialty,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                specialty: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return !selectedBranch ? Alert.alert('Nhắc nhở', 'Vui lòng chọn cơ sở trước') : setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  specialty: true\n                }));\n              },\n              style: [styles.dropdown, !selectedBranch && styles.disabled],\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: getSpecialtyName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: Array.isArray(specialties) && specialties.map(function (s) {\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedSpecialty(s.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    specialty: false\n                  }));\n                },\n                title: s.name\n              }, s.id);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsx(Text, {\n            style: styles.label,\n            children: \"B\\xE1c s\\u0129 kh\\xE1m\"\n          }), _jsxs(Menu, {\n            visible: visibleMenu.doctor,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                doctor: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return !selectedSpecialty ? Alert.alert('Nhắc nhở', 'Vui lòng chọn chuyên khoa trước') : setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  doctor: true\n                }));\n              },\n              style: [styles.dropdown, !selectedSpecialty && styles.disabled],\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  numberOfLines: 1,\n                  style: {\n                    flex: 1\n                  },\n                  children: getDoctorName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: [_jsx(Menu.Item, {\n              onPress: function onPress() {\n                setSelectedDoctor('');\n                setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  doctor: false\n                }));\n              },\n              title: \"Ch\\u1ECDn b\\xE1c s\\u0129 trong khoa n\\xE0y (B\\u1EA5t k\\u1EF3)\"\n            }), Array.isArray(doctors) && doctors.map(function (d) {\n              var _d$user;\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedDoctor(d.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    doctor: false\n                  }));\n                },\n                title: (_d$user = d.user) == null ? void 0 : _d$user.full_name\n              }, d.id);\n            })]\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Ng\\xE0y kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), Platform.OS === 'web' ? _jsx(View, {\n            style: styles.dropdown,\n            children: createElement('input', {\n              type: 'date',\n              value: dayjs(date).format('YYYY-MM-DD'),\n              style: {\n                border: 'none',\n                outline: 'none',\n                width: '100%',\n                fontSize: 16,\n                backgroundColor: 'transparent',\n                fontFamily: 'System'\n              },\n              onChange: function onChange(e) {\n                return setDate(new Date(e.target.value));\n              }\n            })\n          }) : _jsxs(_Fragment, {\n            children: [_jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return setShowDatePicker(true);\n              },\n              style: styles.dropdown,\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: dayjs(date).format('DD/MM/YYYY')\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"calendar\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }), showDatePicker && _jsx(DateTimePicker, {\n              value: date,\n              mode: \"date\",\n              display: Platform.OS === 'ios' ? 'spinner' : 'default',\n              onChange: function onChange(e, d) {\n                setShowDatePicker(Platform.OS === 'ios');\n                if (d) setDate(d);\n              },\n              minimumDate: new Date()\n            })]\n          })]\n        }), selectedBranch && selectedSpecialty && _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Ch\\u1ECDn gi\\u1EDD kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), loadingSlots ? _jsx(View, {\n            style: {\n              padding: 20\n            },\n            children: _jsx(ActivityIndicator, {})\n          }) : slotError || !availableSlots || availableSlots.length === 0 ? _jsx(Text, {\n            style: {\n              color: 'orange',\n              fontStyle: 'italic'\n            },\n            children: \"Kh\\xF4ng t\\xECm th\\u1EA5y l\\u1ECBch tr\\u1ED1ng. Vui l\\xF2ng ch\\u1ECDn ng\\xE0y kh\\xE1c.\"\n          }) : _jsx(View, {\n            style: styles.slotGrid,\n            children: availableSlots.map(function (slot) {\n              return _jsx(TouchableOpacity, {\n                style: [styles.slotItem, selectedTimeSlot === slot && styles.slotSelected],\n                onPress: function onPress() {\n                  return setSelectedTimeSlot(slot);\n                },\n                children: _jsx(Text, {\n                  style: [styles.slotText, selectedTimeSlot === slot && {\n                    color: 'white',\n                    fontWeight: 'bold'\n                  }],\n                  children: slot\n                })\n              }, slot);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Tri\\u1EC7u ch\\u1EE9ng / L\\xFD do \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(TextInput, {\n            mode: \"outlined\",\n            placeholder: \"VD: \\u0110au \\u0111\\u1EA7u, s\\u1ED1t...\",\n            multiline: true,\n            numberOfLines: 3,\n            value: notes,\n            onChangeText: setNotes,\n            style: {\n              backgroundColor: 'white'\n            }\n          })]\n        }), _jsx(Button, {\n          mode: \"contained\",\n          onPress: handleSubmit,\n          loading: createMutation.isPending,\n          style: {\n            marginTop: 12\n          },\n          contentStyle: {\n            height: 48\n          },\n          disabled: !selectedTimeSlot,\n          children: \"Ti\\u1EBFp t\\u1EE5c\"\n        })]\n      })]\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff'\n  },\n  center: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  header: {\n    padding: 16,\n    backgroundColor: '#f5f5f5',\n    borderBottomWidth: 1,\n    borderColor: '#eee'\n  },\n  formContainer: {\n    padding: 16\n  },\n  group: {\n    marginBottom: 16\n  },\n  label: {\n    marginBottom: 6,\n    fontWeight: '500',\n    color: '#444'\n  },\n  dropdown: {\n    borderWidth: 1,\n    borderColor: '#ddd',\n    borderRadius: 6,\n    padding: 12,\n    backgroundColor: 'white'\n  },\n  disabled: {\n    backgroundColor: '#f2f2f2',\n    borderColor: '#e0e0e0'\n  },\n  row: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center'\n  },\n  slotGrid: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 10\n  },\n  slotItem: {\n    width: '23%',\n    paddingVertical: 10,\n    borderRadius: 6,\n    borderWidth: 1,\n    borderColor: '#ccc',\n    alignItems: 'center',\n    backgroundColor: '#fff'\n  },\n  slotSelected: {\n    backgroundColor: '#2196F3',\n    borderColor: '#2196F3'\n  },\n  slotText: {\n    color: '#333',\n    fontSize: 14\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","createElement","View","StyleSheet","ScrollView","Platform","KeyboardAvoidingView","Alert","TouchableOpacity","Text","Button","TextInput","useTheme","Menu","TouchableRipple","ActivityIndicator","Banner","ProgressBar","useQuery","useMutation","useQueryClient","DateTimePicker","MaterialCommunityIcons","dayjs","useNavigation","appointmentService","patientService","useAuthStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BookingScreen","_myPatientProfile$use","theme","navigation","queryClient","_useAuthStore","user","_useQuery","queryKey","id","queryFn","_queryFn","_asyncToGenerator","_patient","_res$data","patient","res","getPatients","limit","found","data","find","p","_p$user","user_id","Error","apply","arguments","enabled","retry","myPatientProfile","isLoadingProfile","isLoading","isProfileError","isError","_useState","_useState2","_slicedToArray","selectedBranch","setSelectedBranch","_useState3","_useState4","selectedSpecialty","setSelectedSpecialty","_useState5","_useState6","selectedDoctor","setSelectedDoctor","_useState7","Date","_useState8","date","setDate","_useState9","_useState0","showDatePicker","setShowDatePicker","_useState1","_useState10","selectedTimeSlot","setSelectedTimeSlot","_useState11","_useState12","notes","setNotes","_useState13","branch","specialty","doctor","_useState14","visibleMenu","setVisibleMenu","_useQuery2","getBranches","_useQuery2$data","branches","_useQuery3","getSpecialties","_useQuery3$data","specialties","_useQuery4","getDoctors","_useQuery4$data","doctors","formattedDate","format","_useQuery5","getAvailableSlots","_useQuery5$data","availableSlots","loadingSlots","isFetching","slotError","error","createMutation","mutationFn","createAppointment","onSuccess","alert","invalidateQueries","navigate","onError","err","_err$response","_err$response$data","msg","response","message","Array","isArray","handleSubmit","trim","_selectedTimeSlot$spl","split","_selectedTimeSlot$spl2","h","m","startDateTime","hour","Number","minute","second","endDateTime","add","mutate","patient_id","branch_id","doctor_assigned_id","undefined","start_time","toISOString","end_time","appointment_type","source","getBranchName","_branches$find","b","name","getSpecialtyName","_specialties$find","s","getDoctorName","_doctors$find","_doctors$find$user","d","full_name","style","styles","center","children","animating","size","padding","visible","actions","label","onPress","behavior","OS","flex","container","contentContainerStyle","paddingBottom","header","variant","fontWeight","color","colors","primary","progress","marginTop","height","borderRadius","formContainer","group","onDismiss","_objectSpread","anchor","dropdown","row","map","Item","title","disabled","numberOfLines","_d$user","type","value","border","outline","width","fontSize","backgroundColor","fontFamily","onChange","e","target","mode","display","minimumDate","length","fontStyle","slotGrid","slot","slotItem","slotSelected","slotText","placeholder","multiline","onChangeText","loading","isPending","contentStyle","create","justifyContent","alignItems","borderBottomWidth","borderColor","marginBottom","borderWidth","flexDirection","flexWrap","gap","paddingVertical"],"sources":["D:/Student/N4_HK2/Web_App/clinic-starter/mobile/src/screens/BookingScreen.tsx"],"sourcesContent":["import React, { useState, useEffect, createElement } from 'react';\r\nimport { View, StyleSheet, ScrollView, Platform, KeyboardAvoidingView, Alert, TouchableOpacity } from 'react-native';\r\nimport { Text, Button, TextInput, useTheme, Menu, TouchableRipple, ActivityIndicator, Banner, ProgressBar } from 'react-native-paper';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { MaterialCommunityIcons } from '@expo/vector-icons'; // <-- SỬ DỤNG ICON TỪ ĐÂY (FIX LỖI)\r\nimport dayjs from 'dayjs';\r\nimport { useNavigation } from '@react-navigation/native';\r\n\r\n// Services & Stores\r\nimport { appointmentService } from '../services/appointment.service';\r\nimport { patientService } from '../services/patient.service';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nexport default function BookingScreen() {\r\n    const theme = useTheme();\r\n    const navigation = useNavigation<any>();\r\n    const queryClient = useQueryClient();\r\n    const { user } = useAuthStore();\r\n\r\n    // --- 1. TÌM HỒ SƠ BỆNH NHÂN (Logic check giống Web) ---\r\n    const { data: myPatientProfile, isLoading: isLoadingProfile, isError: isProfileError } = useQuery({\r\n        queryKey: ['my-patient-profile', user?.id],\r\n        queryFn: async () => {\r\n            if ((user as any)?.patient?.id) return (user as any).patient;\r\n            const res = await patientService.getPatients({ limit: 1000 });\r\n            const found = res.data?.find((p: any) => p.user_id === user?.id || p.user?.id === user?.id);\r\n            if (!found) throw new Error('NOT_FOUND');\r\n            return found;\r\n        },\r\n        enabled: !!user?.id,\r\n        retry: 1\r\n    });\r\n\r\n    // --- 2. STATE FORM ---\r\n    const [selectedBranch, setSelectedBranch] = useState<string>('');\r\n    const [selectedSpecialty, setSelectedSpecialty] = useState<string>('');\r\n    const [selectedDoctor, setSelectedDoctor] = useState<string>('');\r\n    const [date, setDate] = useState(new Date());\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [selectedTimeSlot, setSelectedTimeSlot] = useState<string>('');\r\n    const [notes, setNotes] = useState('');\r\n\r\n    // Menu hiển thị Dropdown\r\n    const [visibleMenu, setVisibleMenu] = useState({ branch: false, specialty: false, doctor: false });\r\n\r\n    // --- 3. DATA FETCHING ---\r\n    const { data: branches = [] } = useQuery({ queryKey: ['branches'], queryFn: appointmentService.getBranches });\r\n    const { data: specialties = [] } = useQuery({ queryKey: ['specialties'], queryFn: appointmentService.getSpecialties });\r\n\r\n    // Lấy bác sĩ (Chỉ load khi đã chọn chuyên khoa - Logic giống Web)\r\n    const { data: doctors = [] } = useQuery({\r\n        queryKey: ['doctors', selectedBranch, selectedSpecialty],\r\n        queryFn: () => appointmentService.getDoctors(selectedBranch, selectedSpecialty),\r\n        enabled: !!selectedSpecialty,\r\n    });\r\n\r\n    // --- 4. GỌI API LẤY SLOT (Logic lưới giờ) ---\r\n    const formattedDate = dayjs(date).format('YYYY-MM-DD');\r\n\r\n    const { data: availableSlots = [], isFetching: loadingSlots, error: slotError } = useQuery({\r\n        queryKey: ['slots', selectedBranch, selectedSpecialty, selectedDoctor, formattedDate],\r\n        queryFn: () => appointmentService.getAvailableSlots(\r\n            selectedBranch,\r\n            selectedSpecialty,\r\n            formattedDate,\r\n            selectedDoctor\r\n        ),\r\n        // Chỉ gọi API khi đã chọn đủ: Cơ sở + Chuyên khoa\r\n        enabled: !!selectedBranch && !!selectedSpecialty,\r\n        retry: false\r\n    });\r\n\r\n    // --- 5. LOGIC RESET ---\r\n    useEffect(() => { setSelectedSpecialty(''); setSelectedDoctor(''); setSelectedTimeSlot(''); }, [selectedBranch]);\r\n    useEffect(() => { setSelectedDoctor(''); setSelectedTimeSlot(''); }, [selectedSpecialty]);\r\n    useEffect(() => { setSelectedTimeSlot(''); }, [selectedDoctor, formattedDate]);\r\n\r\n    // --- 6. SUBMIT ---\r\n    const createMutation = useMutation({\r\n        mutationFn: appointmentService.createAppointment,\r\n        onSuccess: () => {\r\n            Alert.alert('Thành công', 'Đặt lịch khám thành công!');\r\n            queryClient.invalidateQueries(['myAppointments']);\r\n            navigation.navigate('Appointments');\r\n        },\r\n        onError: (err: any) => {\r\n            const msg = err?.response?.data?.message || 'Đặt lịch thất bại';\r\n            Alert.alert('Lỗi', Array.isArray(msg) ? msg[0] : msg);\r\n        },\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!selectedBranch) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Cơ sở');\r\n        if (!selectedSpecialty) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Chuyên khoa');\r\n        if (!selectedTimeSlot) return Alert.alert('Thiếu thông tin', 'Vui lòng chọn Giờ khám');\r\n        if (!notes.trim()) return Alert.alert('Thiếu thông tin', 'Vui lòng nhập Triệu chứng');\r\n\r\n        // Tạo ISO String từ Ngày + Giờ\r\n        const [h, m] = selectedTimeSlot.split(':');\r\n        const startDateTime = dayjs(date).hour(Number(h)).minute(Number(m)).second(0);\r\n        // Backend yêu cầu cả start_time và end_time, ta cộng tạm 30p để gửi lên\r\n        const endDateTime = startDateTime.add(30, 'minute');\r\n\r\n        createMutation.mutate({\r\n            patient_id: myPatientProfile.id,\r\n            branch_id: selectedBranch,\r\n            doctor_assigned_id: selectedDoctor || undefined,\r\n            start_time: startDateTime.toISOString(),\r\n            end_time: endDateTime.toISOString(),\r\n            appointment_type: 'checkup',\r\n            notes: notes,\r\n            source: 'mobile_app'\r\n        });\r\n    };\r\n\r\n    // Helper hiển thị tên\r\n    const getBranchName = () => Array.isArray(branches) ? branches.find(b => b.id === selectedBranch)?.name || 'Chọn cơ sở' : 'Chọn cơ sở';\r\n    const getSpecialtyName = () => Array.isArray(specialties) ? specialties.find(s => s.id === selectedSpecialty)?.name || 'Tất cả chuyên khoa' : 'Tất cả chuyên khoa';\r\n    const getDoctorName = () => {\r\n        if (!selectedDoctor) return 'Bác sĩ trong khoa này (Bất kỳ)';\r\n        return Array.isArray(doctors) ? doctors.find(d => d.id === selectedDoctor)?.user?.full_name : 'Chọn bác sĩ';\r\n    };\r\n\r\n    // --- RENDER ---\r\n    if (isLoadingProfile) return <View style={styles.center}><ActivityIndicator animating size=\"large\" /></View>;\r\n\r\n    if (isProfileError || !myPatientProfile) return (\r\n        <View style={{ padding: 16 }}><Banner visible actions={[{ label: 'Cập nhật', onPress: () => navigation.navigate('Profile') }]}>Chưa có hồ sơ bệnh nhân.</Banner></View>\r\n    );\r\n\r\n    return (\r\n        <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined} style={{ flex: 1 }}>\r\n            <ScrollView style={styles.container} contentContainerStyle={{ paddingBottom: 40 }}>\r\n\r\n                {/* Header */}\r\n                <View style={styles.header}>\r\n                    <Text variant=\"titleMedium\" style={{ fontWeight: 'bold', color: theme.colors.primary }}>\r\n                        Đặt lịch: {myPatientProfile.user?.full_name}\r\n                    </Text>\r\n                    <ProgressBar progress={selectedTimeSlot ? 1 : 0.6} color={theme.colors.primary} style={{ marginTop: 8, height: 4, borderRadius: 2 }} />\r\n                </View>\r\n\r\n                <View style={styles.formContainer}>\r\n\r\n                    {/* 1. CƠ SỞ */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Cơ sở khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <Menu\r\n                            visible={visibleMenu.branch}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, branch: false })}\r\n                            anchor={\r\n                                <TouchableRipple onPress={() => setVisibleMenu({ ...visibleMenu, branch: true })} style={styles.dropdown}>\r\n                                    <View style={styles.row}>\r\n                                        <Text>{getBranchName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            {Array.isArray(branches) && branches.map(b => (\r\n                                <Menu.Item key={b.id} onPress={() => { setSelectedBranch(b.id); setVisibleMenu({ ...visibleMenu, branch: false }); }} title={b.name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 2. CHUYÊN KHOA */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Chuyên khoa <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <Menu\r\n                            visible={visibleMenu.specialty}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, specialty: false })}\r\n                            anchor={\r\n                                <TouchableRipple\r\n                                    onPress={() => !selectedBranch ? Alert.alert('Nhắc nhở', 'Vui lòng chọn cơ sở trước') : setVisibleMenu({ ...visibleMenu, specialty: true })}\r\n                                    style={[styles.dropdown, !selectedBranch && styles.disabled]}\r\n                                >\r\n                                    <View style={styles.row}>\r\n                                        <Text>{getSpecialtyName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            {Array.isArray(specialties) && specialties.map(s => (\r\n                                <Menu.Item key={s.id} onPress={() => { setSelectedSpecialty(s.id); setVisibleMenu({ ...visibleMenu, specialty: false }); }} title={s.name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 3. BÁC SĨ */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Bác sĩ khám</Text>\r\n                        <Menu\r\n                            visible={visibleMenu.doctor}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, doctor: false })}\r\n                            anchor={\r\n                                <TouchableRipple\r\n                                    onPress={() => !selectedSpecialty ? Alert.alert('Nhắc nhở', 'Vui lòng chọn chuyên khoa trước') : setVisibleMenu({ ...visibleMenu, doctor: true })}\r\n                                    style={[styles.dropdown, !selectedSpecialty && styles.disabled]}\r\n                                >\r\n                                    <View style={styles.row}>\r\n                                        <Text numberOfLines={1} style={{ flex: 1 }}>{getDoctorName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            <Menu.Item onPress={() => { setSelectedDoctor(''); setVisibleMenu({ ...visibleMenu, doctor: false }); }} title=\"Chọn bác sĩ trong khoa này (Bất kỳ)\" />\r\n                            {Array.isArray(doctors) && doctors.map(d => (\r\n                                <Menu.Item key={d.id} onPress={() => { setSelectedDoctor(d.id); setVisibleMenu({ ...visibleMenu, doctor: false }); }} title={d.user?.full_name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 4. NGÀY KHÁM */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Ngày khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        {Platform.OS === 'web' ? (\r\n                            <View style={styles.dropdown}>\r\n                                {createElement('input', {\r\n                                    type: 'date',\r\n                                    value: dayjs(date).format('YYYY-MM-DD'),\r\n                                    style: { border: 'none', outline: 'none', width: '100%', fontSize: 16, backgroundColor: 'transparent', fontFamily: 'System' },\r\n                                    onChange: (e: any) => setDate(new Date(e.target.value))\r\n                                })}\r\n                            </View>\r\n                        ) : (\r\n                            <>\r\n                                <TouchableRipple onPress={() => setShowDatePicker(true)} style={styles.dropdown}>\r\n                                    <View style={styles.row}>\r\n                                        <Text>{dayjs(date).format('DD/MM/YYYY')}</Text>\r\n                                        <MaterialCommunityIcons name=\"calendar\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                                {showDatePicker && (\r\n                                    <DateTimePicker\r\n                                        value={date} mode=\"date\" display={Platform.OS === 'ios' ? 'spinner' : 'default'}\r\n                                        onChange={(e, d) => { setShowDatePicker(Platform.OS === 'ios'); if (d) setDate(d); }}\r\n                                        minimumDate={new Date()}\r\n                                    />\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </View>\r\n\r\n                    {/* 5. LƯỚI GIỜ (Slots) */}\r\n                    {selectedBranch && selectedSpecialty && (\r\n                        <View style={styles.group}>\r\n                            <Text style={styles.label}>Chọn giờ khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n\r\n                            {loadingSlots ? (\r\n                                <View style={{ padding: 20 }}><ActivityIndicator /></View>\r\n                            ) : (slotError || !availableSlots || availableSlots.length === 0) ? (\r\n                                <Text style={{ color: 'orange', fontStyle: 'italic' }}>\r\n                                    Không tìm thấy lịch trống. Vui lòng chọn ngày khác.\r\n                                </Text>\r\n                            ) : (\r\n                                <View style={styles.slotGrid}>\r\n                                    {availableSlots.map((slot: string) => (\r\n                                        <TouchableOpacity\r\n                                            key={slot}\r\n                                            style={[\r\n                                                styles.slotItem,\r\n                                                selectedTimeSlot === slot && styles.slotSelected\r\n                                            ]}\r\n                                            onPress={() => setSelectedTimeSlot(slot)}\r\n                                        >\r\n                                            <Text style={[\r\n                                                styles.slotText,\r\n                                                selectedTimeSlot === slot && { color: 'white', fontWeight: 'bold' }\r\n                                            ]}>\r\n                                                {slot}\r\n                                            </Text>\r\n                                        </TouchableOpacity>\r\n                                    ))}\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n                    )}\r\n\r\n                    {/* 6. TRIỆU CHỨNG */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Triệu chứng / Lý do <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <TextInput\r\n                            mode=\"outlined\"\r\n                            placeholder=\"VD: Đau đầu, sốt...\"\r\n                            multiline numberOfLines={3}\r\n                            value={notes} onChangeText={setNotes}\r\n                            style={{ backgroundColor: 'white' }}\r\n                        />\r\n                    </View>\r\n\r\n                    {/* SUBMIT BUTTON */}\r\n                    <Button\r\n                        mode=\"contained\"\r\n                        onPress={handleSubmit}\r\n                        loading={createMutation.isPending}\r\n                        style={{ marginTop: 12 }}\r\n                        contentStyle={{ height: 48 }}\r\n                        disabled={!selectedTimeSlot}\r\n                    >\r\n                        Tiếp tục\r\n                    </Button>\r\n\r\n                </View>\r\n            </ScrollView>\r\n        </KeyboardAvoidingView>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#fff' },\r\n    center: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n    header: { padding: 16, backgroundColor: '#f5f5f5', borderBottomWidth: 1, borderColor: '#eee' },\r\n    formContainer: { padding: 16 },\r\n    group: { marginBottom: 16 },\r\n    label: { marginBottom: 6, fontWeight: '500', color: '#444' },\r\n    dropdown: { borderWidth: 1, borderColor: '#ddd', borderRadius: 6, padding: 12, backgroundColor: 'white' },\r\n    disabled: { backgroundColor: '#f2f2f2', borderColor: '#e0e0e0' },\r\n    row: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' },\r\n    slotGrid: { flexDirection: 'row', flexWrap: 'wrap', gap: 10 },\r\n    slotItem: {\r\n        width: '23%',\r\n        paddingVertical: 10,\r\n        borderRadius: 6,\r\n        borderWidth: 1,\r\n        borderColor: '#ccc',\r\n        alignItems: 'center',\r\n        backgroundColor: '#fff',\r\n    },\r\n    slotSelected: {\r\n        backgroundColor: '#2196F3',\r\n        borderColor: '#2196F3',\r\n    },\r\n    slotText: {\r\n        color: '#333',\r\n        fontSize: 14,\r\n    }\r\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}