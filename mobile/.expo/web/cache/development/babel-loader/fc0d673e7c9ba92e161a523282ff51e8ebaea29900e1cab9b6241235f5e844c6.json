{"ast":null,"code":"import axiosInstance from \"../lib/axios\";\nexport var appointmentService = {\n  getMyAppointments: function getMyAppointments() {\n    return axiosInstance.get('/appointments').then(function (res) {\n      return res.data;\n    });\n  },\n  getAppointmentById: function getAppointmentById(id) {\n    return axiosInstance.get(\"/appointments/\" + id).then(function (res) {\n      return res.data;\n    });\n  },\n  getBranches: function getBranches() {\n    return axiosInstance.get('/branches').then(function (res) {\n      return res.data;\n    });\n  },\n  getSpecialties: function getSpecialties() {\n    return axiosInstance.get('/specializations').then(function (res) {\n      return res.data;\n    }).catch(function (err) {\n      console.error(\"Lỗi lấy chuyên khoa:\", err);\n      return [];\n    });\n  },\n  getDoctors: function getDoctors(branchId, specialtyId) {\n    var params = {};\n    if (branchId) params.branch_id = branchId;\n    if (specialtyId) {\n      params.specialization_id = specialtyId;\n      params.specialty_id = specialtyId;\n    }\n    return axiosInstance.get('/doctors', {\n      params: params\n    }).then(function (res) {\n      if (res.data && Array.isArray(res.data.data)) {\n        return res.data.data;\n      }\n      if (Array.isArray(res.data)) {\n        return res.data;\n      }\n      return [];\n    });\n  },\n  getAvailableSlots: function getAvailableSlots(branchId, specialtyId, date, doctorId) {\n    var params = {\n      branch_id: branchId,\n      specialization_id: specialtyId,\n      date: date,\n      doctor_id: doctorId || undefined\n    };\n    return axiosInstance.get('/appointments/available-slots', {\n      params: params\n    }).then(function (res) {\n      return res.data;\n    });\n  },\n  createAppointment: function createAppointment(data) {\n    return axiosInstance.post('/appointments', data).then(function (res) {\n      return res.data;\n    });\n  }\n};","map":{"version":3,"names":["axiosInstance","appointmentService","getMyAppointments","get","then","res","data","getAppointmentById","id","getBranches","getSpecialties","catch","err","console","error","getDoctors","branchId","specialtyId","params","branch_id","specialization_id","specialty_id","Array","isArray","getAvailableSlots","date","doctorId","doctor_id","undefined","createAppointment","post"],"sources":["D:/Student/N4_HK2/Web_App/clinic-starter/mobile/src/services/appointment.service.ts"],"sourcesContent":["import axiosInstance from '../lib/axios';\r\n\r\n// --- INTERFACES CŨ (GIỮ LẠI ĐỂ KHÔNG LỖI APP) ---\r\nexport interface Appointment {\r\n  id: string;\r\n  patient_id: string;\r\n  doctor_assigned_id: string;\r\n  room_id: string;\r\n  start_time: string;\r\n  end_time: string;\r\n  status: string;\r\n  appointment_type: string;\r\n  notes?: string;\r\n  doctor?: {\r\n    code: string;\r\n    title: string;\r\n    user: {\r\n      full_name: string;\r\n    };\r\n  };\r\n  room?: {\r\n    name: string;\r\n    code: string;\r\n  };\r\n  // Dữ liệu quan trọng cho hồ sơ bệnh án\r\n  medical_record?: MedicalRecord;\r\n  prescriptions?: { items: PrescriptionItem[] }[];\r\n}\r\n\r\nexport interface AppointmentListResponse {\r\n  data: Appointment[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\n// --- INTERFACES CHO TÍNH NĂNG MỚI ---\r\nexport interface Branch {\r\n  id: string;\r\n  name: string;\r\n  address: string;\r\n}\r\n\r\nexport interface Specialty {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nexport interface Doctor {\r\n  id: string;\r\n  user: {\r\n    full_name: string;\r\n  };\r\n  specialty_id: string;\r\n}\r\n\r\nexport interface CreateAppointmentDto {\r\n  patient_id: string; // Thêm trường này theo yêu cầu backend\r\n  doctor_assigned_id?: string;\r\n  branch_id: string;\r\n  start_time: string;\r\n  end_time: string;\r\n  notes: string;\r\n  appointment_type?: string;\r\n  source?: string;\r\n}\r\n\r\nexport interface MedicalRecord {\r\n  id: string;\r\n  diagnosis: string;\r\n  symptoms: string;\r\n  heart_rate?: number;\r\n  temperature?: number;\r\n  blood_pressure?: string;\r\n  weight?: number;\r\n  height?: number;\r\n  note?: string;\r\n}\r\n\r\n// --- SERVICE ĐẦY ĐỦ ---\r\nexport const appointmentService = {\r\n\r\n  // 1. CÁC HÀM CŨ (KHÔI PHỤC LẠI) - Để màn hình Danh sách & Chi tiết chạy được\r\n  getMyAppointments: (): Promise<AppointmentListResponse> => {\r\n    return axiosInstance.get('/appointments').then((res) => res.data);\r\n  },\r\n\r\n  getAppointmentById: (id: string): Promise<Appointment> => {\r\n    return axiosInstance.get(`/appointments/${id}`).then((res) => res.data);\r\n  },\r\n\r\n  // 2. CÁC HÀM CHO FORM ĐẶT LỊCH (Branches, Specialties, Doctors)\r\n  getBranches: () => axiosInstance.get('/branches').then(res => res.data),\r\n\r\n  // [SỬA LỖI 1]: Đổi endpoint sang /specializations (hoặc bạn kiểm tra lại API Swagger backend xem tên đúng là gì)\r\n  getSpecialties: (): Promise<Specialty[]> => {\r\n    return axiosInstance.get('/specializations')\r\n      .then((res) => res.data)\r\n      .catch((err) => {\r\n        console.error(\"Lỗi lấy chuyên khoa:\", err);\r\n        return []; // Trả về rỗng để không crash app\r\n      });\r\n  },\r\n\r\n  getDoctors: (branchId?: string, specialtyId?: string): Promise<Doctor[]> => {\r\n    const params: any = {};\r\n    if (branchId) params.branch_id = branchId;\r\n\r\n    // Lưu ý: Kiểm tra lại với Backend xem họ dùng 'specialization_id' hay 'specialty_id'\r\n    // Tôi để cả 2 để chắc chắn trúng\r\n    if (specialtyId) {\r\n      params.specialization_id = specialtyId;\r\n      params.specialty_id = specialtyId;\r\n    }\r\n\r\n    return axiosInstance.get('/doctors', { params }).then((res) => {\r\n      // LOGIC MỚI: Kiểm tra cấu trúc dữ liệu trả về\r\n      if (res.data && Array.isArray(res.data.data)) {\r\n        return res.data.data; // Trường hợp có phân trang { data: [], pagination: ... }\r\n      }\r\n      if (Array.isArray(res.data)) {\r\n        return res.data; // Trường hợp trả về mảng trực tiếp []\r\n      }\r\n      return []; // Fallback nếu dữ liệu lạ\r\n    });\r\n  },\r\n\r\n  // Hàm lấy Slot\r\n  getAvailableSlots: (branchId: string, specialtyId: string, date: string, doctorId?: string) => {\r\n    const params = {\r\n      branch_id: branchId,\r\n      specialization_id: specialtyId,\r\n      date: date,\r\n      doctor_id: doctorId || undefined\r\n    };\r\n    return axiosInstance.get('/appointments/available-slots', { params }).then(res => res.data);\r\n  },\r\n\r\n  createAppointment: (data: any) => axiosInstance.post('/appointments', data).then(res => res.data),\r\n};"],"mappings":"AAAA,OAAOA,aAAa;AAmFpB,OAAO,IAAMC,kBAAkB,GAAG;EAGhCC,iBAAiB,EAAE,SAAnBA,iBAAiBA,CAAA,EAA0C;IACzD,OAAOF,aAAa,CAACG,GAAG,CAAC,eAAe,CAAC,CAACC,IAAI,CAAC,UAACC,GAAG;MAAA,OAAKA,GAAG,CAACC,IAAI;IAAA,EAAC;EACnE,CAAC;EAEDC,kBAAkB,EAAE,SAApBA,kBAAkBA,CAAGC,EAAU,EAA2B;IACxD,OAAOR,aAAa,CAACG,GAAG,oBAAkBK,EAAI,CAAC,CAACJ,IAAI,CAAC,UAACC,GAAG;MAAA,OAAKA,GAAG,CAACC,IAAI;IAAA,EAAC;EACzE,CAAC;EAGDG,WAAW,EAAE,SAAbA,WAAWA,CAAA;IAAA,OAAQT,aAAa,CAACG,GAAG,CAAC,WAAW,CAAC,CAACC,IAAI,CAAC,UAAAC,GAAG;MAAA,OAAIA,GAAG,CAACC,IAAI;IAAA,EAAC;EAAA;EAGvEI,cAAc,EAAE,SAAhBA,cAAcA,CAAA,EAA8B;IAC1C,OAAOV,aAAa,CAACG,GAAG,CAAC,kBAAkB,CAAC,CACzCC,IAAI,CAAC,UAACC,GAAG;MAAA,OAAKA,GAAG,CAACC,IAAI;IAAA,EAAC,CACvBK,KAAK,CAAC,UAACC,GAAG,EAAK;MACdC,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEF,GAAG,CAAC;MAC1C,OAAO,EAAE;IACX,CAAC,CAAC;EACN,CAAC;EAEDG,UAAU,EAAE,SAAZA,UAAUA,CAAGC,QAAiB,EAAEC,WAAoB,EAAwB;IAC1E,IAAMC,MAAW,GAAG,CAAC,CAAC;IACtB,IAAIF,QAAQ,EAAEE,MAAM,CAACC,SAAS,GAAGH,QAAQ;IAIzC,IAAIC,WAAW,EAAE;MACfC,MAAM,CAACE,iBAAiB,GAAGH,WAAW;MACtCC,MAAM,CAACG,YAAY,GAAGJ,WAAW;IACnC;IAEA,OAAOjB,aAAa,CAACG,GAAG,CAAC,UAAU,EAAE;MAAEe,MAAM,EAANA;IAAO,CAAC,CAAC,CAACd,IAAI,CAAC,UAACC,GAAG,EAAK;MAE7D,IAAIA,GAAG,CAACC,IAAI,IAAIgB,KAAK,CAACC,OAAO,CAAClB,GAAG,CAACC,IAAI,CAACA,IAAI,CAAC,EAAE;QAC5C,OAAOD,GAAG,CAACC,IAAI,CAACA,IAAI;MACtB;MACA,IAAIgB,KAAK,CAACC,OAAO,CAAClB,GAAG,CAACC,IAAI,CAAC,EAAE;QAC3B,OAAOD,GAAG,CAACC,IAAI;MACjB;MACA,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC;EAGDkB,iBAAiB,EAAE,SAAnBA,iBAAiBA,CAAGR,QAAgB,EAAEC,WAAmB,EAAEQ,IAAY,EAAEC,QAAiB,EAAK;IAC7F,IAAMR,MAAM,GAAG;MACbC,SAAS,EAAEH,QAAQ;MACnBI,iBAAiB,EAAEH,WAAW;MAC9BQ,IAAI,EAAEA,IAAI;MACVE,SAAS,EAAED,QAAQ,IAAIE;IACzB,CAAC;IACD,OAAO5B,aAAa,CAACG,GAAG,CAAC,+BAA+B,EAAE;MAAEe,MAAM,EAANA;IAAO,CAAC,CAAC,CAACd,IAAI,CAAC,UAAAC,GAAG;MAAA,OAAIA,GAAG,CAACC,IAAI;IAAA,EAAC;EAC7F,CAAC;EAEDuB,iBAAiB,EAAE,SAAnBA,iBAAiBA,CAAGvB,IAAS;IAAA,OAAKN,aAAa,CAAC8B,IAAI,CAAC,eAAe,EAAExB,IAAI,CAAC,CAACF,IAAI,CAAC,UAAAC,GAAG;MAAA,OAAIA,GAAG,CAACC,IAAI;IAAA,EAAC;EAAA;AACnG,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}