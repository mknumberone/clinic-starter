{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axiosInstance from \"../lib/axios\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nexport var chatService = {\n  getMyConversation: function () {\n    var _getMyConversation = _asyncToGenerator(function* () {\n      var res = yield axiosInstance.get('/chat/conversations');\n      return res.data[0] || null;\n    });\n    function getMyConversation() {\n      return _getMyConversation.apply(this, arguments);\n    }\n    return getMyConversation;\n  }(),\n  getMessages: function getMessages(conversationId) {\n    return axiosInstance.get('/chat/messages', {\n      params: {\n        conversationId: conversationId\n      }\n    }).then(function (res) {\n      return res.data;\n    });\n  },\n  uploadImage: function () {\n    var _uploadImage = _asyncToGenerator(function* (imageUri) {\n      var formData = new FormData();\n      var filename = imageUri.split('/').pop() || \"upload_\" + Date.now() + \".jpg\";\n      var uri = Platform.OS === 'ios' ? imageUri.replace('file://', '') : imageUri;\n      var fileData = {\n        uri: uri,\n        name: filename,\n        type: 'image/jpeg'\n      };\n      formData.append('file', fileData);\n      var res = yield axiosInstance.post('/chat/upload', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        transformRequest: function transformRequest(data, headers) {\n          return formData;\n        }\n      });\n      return res.data;\n    });\n    function uploadImage(_x) {\n      return _uploadImage.apply(this, arguments);\n    }\n    return uploadImage;\n  }()\n};","map":{"version":3,"names":["axiosInstance","Platform","chatService","getMyConversation","_getMyConversation","_asyncToGenerator","res","get","data","apply","arguments","getMessages","conversationId","params","then","uploadImage","_uploadImage","imageUri","formData","FormData","filename","split","pop","Date","now","uri","OS","replace","fileData","name","type","append","post","headers","transformRequest","_x"],"sources":["D:/Student/N4_HK2/Web_App/clinic-starter/mobile/src/services/chat.service.ts"],"sourcesContent":["import axiosInstance from '../lib/axios';\r\nimport { Platform } from 'react-native';\r\n\r\nexport interface Message {\r\n    id: string;\r\n    conversation_id: string;\r\n    sender_id: string;\r\n    content: string;\r\n    type: 'TEXT' | 'IMAGE' | 'FILE';\r\n    created_at: string;\r\n    sender: { id: string; full_name: string; avatar?: string };\r\n}\r\n\r\nexport const chatService = {\r\n    // 1. Lấy hội thoại\r\n    getMyConversation: async () => {\r\n        const res = await axiosInstance.get('/chat/conversations');\r\n        return res.data[0] || null;\r\n    },\r\n\r\n    // 2. Lấy tin nhắn\r\n    getMessages: (conversationId: string) => {\r\n        return axiosInstance.get('/chat/messages', { params: { conversationId } }).then(res => res.data);\r\n    },\r\n\r\n    // 3. Upload ảnh (ĐÃ SỬA CHO CHUẨN REACT NATIVE)\r\n    uploadImage: async (imageUri: string) => {\r\n        const formData = new FormData();\r\n\r\n        // Tạo tên file ngẫu nhiên hoặc lấy từ đường dẫn\r\n        const filename = imageUri.split('/').pop() || `upload_${Date.now()}.jpg`;\r\n\r\n        // Chuẩn hóa đường dẫn URI cho Android\r\n        // Trên Android, uri thường đã có 'file://', nhưng đôi khi cần giữ nguyên\r\n        const uri = Platform.OS === 'ios' ? imageUri.replace('file://', '') : imageUri;\r\n\r\n        // BẮT BUỘC phải có object dạng này để React Native hiểu là file upload\r\n        const fileData = {\r\n            uri: uri,\r\n            name: filename,\r\n            type: 'image/jpeg', // Định dạng ảnh (quan trọng)\r\n        } as any;\r\n\r\n        formData.append('file', fileData);\r\n\r\n        // Gửi request multipart/form-data\r\n        const res = await axiosInstance.post('/chat/upload', formData, {\r\n            headers: {\r\n                'Content-Type': 'multipart/form-data',\r\n                // Nếu axiosInstance đã có interceptor thêm token thì ko cần thêm ở đây\r\n            },\r\n            transformRequest: (data, headers) => {\r\n                // Hack nhỏ để tránh axios tự động stringify FormData trên RN cũ\r\n                return formData;\r\n            },\r\n        });\r\n\r\n        return res.data; // Server trả về { filename: '...' }\r\n    }\r\n};"],"mappings":";AAAA,OAAOA,aAAa;AAAqB,OAAAC,QAAA;AAazC,OAAO,IAAMC,WAAW,GAAG;EAEvBC,iBAAiB;IAAA,IAAAC,kBAAA,GAAAC,iBAAA,CAAE,aAAY;MAC3B,IAAMC,GAAG,SAASN,aAAa,CAACO,GAAG,CAAC,qBAAqB,CAAC;MAC1D,OAAOD,GAAG,CAACE,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI;IAC9B,CAAC;IAAA,SAHDL,iBAAiBA,CAAA;MAAA,OAAAC,kBAAA,CAAAK,KAAA,OAAAC,SAAA;IAAA;IAAA,OAAjBP,iBAAiB;EAAA,GAGhB;EAGDQ,WAAW,EAAE,SAAbA,WAAWA,CAAGC,cAAsB,EAAK;IACrC,OAAOZ,aAAa,CAACO,GAAG,CAAC,gBAAgB,EAAE;MAAEM,MAAM,EAAE;QAAED,cAAc,EAAdA;MAAe;IAAE,CAAC,CAAC,CAACE,IAAI,CAAC,UAAAR,GAAG;MAAA,OAAIA,GAAG,CAACE,IAAI;IAAA,EAAC;EACpG,CAAC;EAGDO,WAAW;IAAA,IAAAC,YAAA,GAAAX,iBAAA,CAAE,WAAOY,QAAgB,EAAK;MACrC,IAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAG/B,IAAMC,QAAQ,GAAGH,QAAQ,CAACI,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC,gBAAcC,IAAI,CAACC,GAAG,CAAC,CAAC,SAAM;MAIxE,IAAMC,GAAG,GAAGxB,QAAQ,CAACyB,EAAE,KAAK,KAAK,GAAGT,QAAQ,CAACU,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GAAGV,QAAQ;MAG9E,IAAMW,QAAQ,GAAG;QACbH,GAAG,EAAEA,GAAG;QACRI,IAAI,EAAET,QAAQ;QACdU,IAAI,EAAE;MACV,CAAQ;MAERZ,QAAQ,CAACa,MAAM,CAAC,MAAM,EAAEH,QAAQ,CAAC;MAGjC,IAAMtB,GAAG,SAASN,aAAa,CAACgC,IAAI,CAAC,cAAc,EAAEd,QAAQ,EAAE;QAC3De,OAAO,EAAE;UACL,cAAc,EAAE;QAEpB,CAAC;QACDC,gBAAgB,EAAE,SAAlBA,gBAAgBA,CAAG1B,IAAI,EAAEyB,OAAO,EAAK;UAEjC,OAAOf,QAAQ;QACnB;MACJ,CAAC,CAAC;MAEF,OAAOZ,GAAG,CAACE,IAAI;IACnB,CAAC;IAAA,SAhCDO,WAAWA,CAAAoB,EAAA;MAAA,OAAAnB,YAAA,CAAAP,KAAA,OAAAC,SAAA;IAAA;IAAA,OAAXK,WAAW;EAAA;AAiCf,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}