{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useState, useEffect, createElement } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-paper/lib/module/components/Typography/Text\";\nimport Button from \"react-native-paper/lib/module/components/Button/Button\";\nimport TextInput from \"react-native-paper/lib/module/components/TextInput/TextInput\";\nimport { useTheme } from \"react-native-paper/lib/module/core/theming\";\nimport Menu from \"react-native-paper/lib/module/components/Menu/Menu\";\nimport TouchableRipple from \"react-native-paper/lib/module/components/TouchableRipple/TouchableRipple\";\nimport ActivityIndicator from \"react-native-paper/lib/module/components/ActivityIndicator\";\nimport Banner from \"react-native-paper/lib/module/components/Banner\";\nimport ProgressBar from \"react-native-paper/lib/module/components/ProgressBar\";\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport DateTimePicker from '@react-native-community/datetimepicker';\nimport { MaterialCommunityIcons } from '@expo/vector-icons';\nimport dayjs from 'dayjs';\nimport { useNavigation } from '@react-navigation/native';\nimport { appointmentService } from \"../services/appointment.service\";\nimport { patientService } from \"../services/patient.service\";\nimport { useAuthStore } from \"../stores/authStore\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default function BookingScreen() {\n  var _myPatientProfile$use;\n  var theme = useTheme();\n  var navigation = useNavigation();\n  var queryClient = useQueryClient();\n  var _useAuthStore = useAuthStore(),\n    user = _useAuthStore.user;\n  var _useQuery = useQuery({\n      queryKey: ['branches'],\n      queryFn: appointmentService.getBranches\n    }),\n    _useQuery$data = _useQuery.data,\n    branches = _useQuery$data === void 0 ? [] : _useQuery$data;\n  var _useQuery2 = useQuery({\n      queryKey: ['specialties'],\n      queryFn: appointmentService.getSpecialties\n    }),\n    _useQuery2$data = _useQuery2.data,\n    specialties = _useQuery2$data === void 0 ? [] : _useQuery2$data;\n  var _useQuery3 = useQuery({\n      queryKey: ['my-patient-profile', user == null ? void 0 : user.id],\n      queryFn: function () {\n        var _queryFn = _asyncToGenerator(function* () {\n          var _patient, _res$data;\n          if (user != null && (_patient = user.patient) != null && _patient.id) return user.patient;\n          var res = yield patientService.getPatients({\n            limit: 1000\n          });\n          var found = (_res$data = res.data) == null ? void 0 : _res$data.find(function (p) {\n            var _p$user;\n            return p.user_id === (user == null ? void 0 : user.id) || ((_p$user = p.user) == null ? void 0 : _p$user.id) === (user == null ? void 0 : user.id);\n          });\n          if (!found) throw new Error('NOT_FOUND');\n          return found;\n        });\n        function queryFn() {\n          return _queryFn.apply(this, arguments);\n        }\n        return queryFn;\n      }(),\n      enabled: !!(user != null && user.id),\n      retry: 1\n    }),\n    myPatientProfile = _useQuery3.data,\n    isLoadingProfile = _useQuery3.isLoading,\n    isProfileError = _useQuery3.isError;\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    selectedBranch = _useState2[0],\n    setSelectedBranch = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedSpecialty = _useState4[0],\n    setSelectedSpecialty = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    selectedDoctor = _useState6[0],\n    setSelectedDoctor = _useState6[1];\n  var _useState7 = useState(new Date()),\n    _useState8 = _slicedToArray(_useState7, 2),\n    date = _useState8[0],\n    setDate = _useState8[1];\n  var _useState9 = useState(false),\n    _useState0 = _slicedToArray(_useState9, 2),\n    showDatePicker = _useState0[0],\n    setShowDatePicker = _useState0[1];\n  var _useState1 = useState(''),\n    _useState10 = _slicedToArray(_useState1, 2),\n    selectedTimeSlot = _useState10[0],\n    setSelectedTimeSlot = _useState10[1];\n  var _useState11 = useState(''),\n    _useState12 = _slicedToArray(_useState11, 2),\n    notes = _useState12[0],\n    setNotes = _useState12[1];\n  var _useState13 = useState({\n      branch: false,\n      specialty: false,\n      doctor: false\n    }),\n    _useState14 = _slicedToArray(_useState13, 2),\n    visibleMenu = _useState14[0],\n    setVisibleMenu = _useState14[1];\n  var _useQuery4 = useQuery({\n      queryKey: ['doctors', selectedBranch, selectedSpecialty],\n      queryFn: function queryFn() {\n        return appointmentService.getDoctors(selectedBranch, selectedSpecialty);\n      },\n      enabled: !!selectedSpecialty\n    }),\n    _useQuery4$data = _useQuery4.data,\n    doctors = _useQuery4$data === void 0 ? [] : _useQuery4$data;\n  var formattedDate = dayjs(date).format('YYYY-MM-DD');\n  var _useQuery5 = useQuery({\n      queryKey: ['slots', selectedBranch, selectedSpecialty, selectedDoctor, formattedDate],\n      queryFn: function queryFn() {\n        return appointmentService.getAvailableSlots(selectedBranch, selectedSpecialty, formattedDate, selectedDoctor);\n      },\n      enabled: !!selectedBranch && !!selectedSpecialty,\n      retry: false\n    }),\n    _useQuery5$data = _useQuery5.data,\n    availableSlots = _useQuery5$data === void 0 ? [] : _useQuery5$data,\n    loadingSlots = _useQuery5.isFetching;\n  useEffect(function () {\n    setSelectedSpecialty('');\n    setSelectedDoctor('');\n    setSelectedTimeSlot('');\n  }, [selectedBranch]);\n  useEffect(function () {\n    setSelectedDoctor('');\n    setSelectedTimeSlot('');\n  }, [selectedSpecialty]);\n  useEffect(function () {\n    setSelectedTimeSlot('');\n  }, [selectedDoctor, formattedDate]);\n  var showAlert = function showAlert(title, message, onOk) {\n    if (Platform.OS === 'web') {\n      window.alert(title + \": \" + message);\n      if (onOk) onOk();\n    } else {\n      Alert.alert(title, message, [{\n        text: 'OK',\n        onPress: onOk\n      }]);\n    }\n  };\n  var createMutation = useMutation({\n    mutationFn: appointmentService.createAppointment,\n    onSuccess: function onSuccess(response) {\n      var message = (response == null ? void 0 : response.message) || 'Đặt lịch thành công!';\n      showAlert('Thông báo', message, function () {\n        queryClient.invalidateQueries(['myAppointments']);\n        navigation.navigate('Appointments');\n      });\n    },\n    onError: function onError(err) {\n      var _err$response, _err$response$data;\n      var msg = (err == null ? void 0 : (_err$response = err.response) == null ? void 0 : (_err$response$data = _err$response.data) == null ? void 0 : _err$response$data.message) || 'Có lỗi xảy ra';\n      showAlert('Lỗi', Array.isArray(msg) ? msg[0] : msg);\n    }\n  });\n  var handleSubmit = function handleSubmit() {\n    if (!selectedBranch) return showAlert('Thiếu thông tin', 'Vui lòng chọn Cơ sở');\n    if (!selectedSpecialty) return showAlert('Thiếu thông tin', 'Vui lòng chọn Chuyên khoa');\n    if (!selectedTimeSlot) return showAlert('Thiếu thông tin', 'Vui lòng chọn Giờ khám');\n    if (!notes.trim()) return showAlert('Thiếu thông tin', 'Vui lòng nhập Triệu chứng/Lý do khám');\n    var _selectedTimeSlot$spl = selectedTimeSlot.split(':'),\n      _selectedTimeSlot$spl2 = _slicedToArray(_selectedTimeSlot$spl, 2),\n      h = _selectedTimeSlot$spl2[0],\n      m = _selectedTimeSlot$spl2[1];\n    var startDateTime = dayjs(date).hour(Number(h)).minute(Number(m)).second(0);\n    var endDateTime = startDateTime.add(30, 'minute');\n    createMutation.mutate({\n      patient_id: myPatientProfile.id,\n      branch_id: selectedBranch,\n      doctor_assigned_id: selectedDoctor || undefined,\n      start_time: startDateTime.toISOString(),\n      end_time: endDateTime.toISOString(),\n      notes: notes,\n      appointment_type: 'checkup',\n      source: 'mobile_app'\n    });\n  };\n  var getBranchName = function getBranchName() {\n    var _branches$find;\n    return Array.isArray(branches) ? ((_branches$find = branches.find(function (b) {\n      return b.id === selectedBranch;\n    })) == null ? void 0 : _branches$find.name) || 'Chọn cơ sở' : 'Chọn cơ sở';\n  };\n  var getSpecialtyName = function getSpecialtyName() {\n    var _specialties$find;\n    return Array.isArray(specialties) ? ((_specialties$find = specialties.find(function (s) {\n      return s.id === selectedSpecialty;\n    })) == null ? void 0 : _specialties$find.name) || 'Tất cả chuyên khoa' : 'Tất cả chuyên khoa';\n  };\n  var getDoctorName = function getDoctorName() {\n    var _doctors$find, _doctors$find$user;\n    return Array.isArray(doctors) ? ((_doctors$find = doctors.find(function (d) {\n      return d.id === selectedDoctor;\n    })) == null ? void 0 : (_doctors$find$user = _doctors$find.user) == null ? void 0 : _doctors$find$user.full_name) || 'Bác sĩ bất kỳ' : 'Bác sĩ bất kỳ';\n  };\n  if (isLoadingProfile) return _jsx(View, {\n    style: styles.center,\n    children: _jsx(ActivityIndicator, {\n      animating: true,\n      size: \"large\"\n    })\n  });\n  if (isProfileError || !myPatientProfile) return _jsx(View, {\n    style: {\n      padding: 16\n    },\n    children: _jsx(Banner, {\n      visible: true,\n      actions: [{\n        label: 'Cập nhật',\n        onPress: function onPress() {\n          return navigation.navigate('Profile');\n        }\n      }],\n      children: \"Ch\\u01B0a c\\xF3 h\\u1ED3 s\\u01A1 b\\u1EC7nh nh\\xE2n.\"\n    })\n  });\n  return _jsx(KeyboardAvoidingView, {\n    behavior: Platform.OS === 'ios' ? 'padding' : undefined,\n    style: {\n      flex: 1\n    },\n    children: _jsxs(ScrollView, {\n      style: styles.container,\n      contentContainerStyle: {\n        paddingBottom: 40\n      },\n      children: [_jsxs(View, {\n        style: styles.header,\n        children: [_jsxs(Text, {\n          variant: \"titleMedium\",\n          style: {\n            fontWeight: 'bold',\n            color: theme.colors.primary\n          },\n          children: [\"\\u0110\\u1EB7t l\\u1ECBch: \", (_myPatientProfile$use = myPatientProfile.user) == null ? void 0 : _myPatientProfile$use.full_name]\n        }), _jsx(ProgressBar, {\n          progress: selectedTimeSlot ? 1 : 0.6,\n          color: theme.colors.primary,\n          style: {\n            marginTop: 8,\n            height: 4,\n            borderRadius: 2\n          }\n        })]\n      }), _jsxs(View, {\n        style: styles.formContainer,\n        children: [_jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"C\\u01A1 s\\u1EDF kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(Menu, {\n            visible: visibleMenu.branch,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                branch: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  branch: true\n                }));\n              },\n              style: styles.dropdown,\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: getBranchName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: Array.isArray(branches) && branches.map(function (b) {\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedBranch(b.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    branch: false\n                  }));\n                },\n                title: b.name\n              }, b.id);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Chuy\\xEAn khoa \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(Menu, {\n            visible: visibleMenu.specialty,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                specialty: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return !selectedBranch ? showAlert('Lưu ý', 'Vui lòng chọn cơ sở trước') : setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  specialty: true\n                }));\n              },\n              style: [styles.dropdown, !selectedBranch && styles.disabled],\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: getSpecialtyName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: Array.isArray(specialties) && specialties.map(function (s) {\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedSpecialty(s.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    specialty: false\n                  }));\n                },\n                title: s.name\n              }, s.id);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsx(Text, {\n            style: styles.label,\n            children: \"B\\xE1c s\\u0129 kh\\xE1m\"\n          }), _jsxs(Menu, {\n            visible: visibleMenu.doctor,\n            onDismiss: function onDismiss() {\n              return setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                doctor: false\n              }));\n            },\n            anchor: _jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return !selectedSpecialty ? showAlert('Lưu ý', 'Vui lòng chọn chuyên khoa trước') : setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  doctor: true\n                }));\n              },\n              style: [styles.dropdown, !selectedSpecialty && styles.disabled],\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  numberOfLines: 1,\n                  style: {\n                    flex: 1\n                  },\n                  children: getDoctorName()\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"chevron-down\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }),\n            children: [_jsx(Menu.Item, {\n              onPress: function onPress() {\n                setSelectedDoctor('');\n                setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                  doctor: false\n                }));\n              },\n              title: \"Ch\\u1ECDn b\\xE1c s\\u0129 trong khoa n\\xE0y (B\\u1EA5t k\\u1EF3)\"\n            }), Array.isArray(doctors) && doctors.map(function (d) {\n              var _d$user;\n              return _jsx(Menu.Item, {\n                onPress: function onPress() {\n                  setSelectedDoctor(d.id);\n                  setVisibleMenu(_objectSpread(_objectSpread({}, visibleMenu), {}, {\n                    doctor: false\n                  }));\n                },\n                title: (_d$user = d.user) == null ? void 0 : _d$user.full_name\n              }, d.id);\n            })]\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Ng\\xE0y kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), Platform.OS === 'web' ? _jsx(View, {\n            style: styles.dropdown,\n            children: createElement('input', {\n              type: 'date',\n              value: dayjs(date).format('YYYY-MM-DD'),\n              style: {\n                border: 'none',\n                outline: 'none',\n                width: '100%',\n                fontSize: 16,\n                backgroundColor: 'transparent',\n                fontFamily: 'System'\n              },\n              onChange: function onChange(e) {\n                return setDate(new Date(e.target.value));\n              }\n            })\n          }) : _jsxs(_Fragment, {\n            children: [_jsx(TouchableRipple, {\n              onPress: function onPress() {\n                return setShowDatePicker(true);\n              },\n              style: styles.dropdown,\n              children: _jsxs(View, {\n                style: styles.row,\n                children: [_jsx(Text, {\n                  children: dayjs(date).format('DD/MM/YYYY')\n                }), _jsx(MaterialCommunityIcons, {\n                  name: \"calendar\",\n                  size: 24,\n                  color: \"#777\"\n                })]\n              })\n            }), showDatePicker && _jsx(DateTimePicker, {\n              value: date,\n              mode: \"date\",\n              display: Platform.OS === 'ios' ? 'spinner' : 'default',\n              onChange: function onChange(e, d) {\n                setShowDatePicker(Platform.OS === 'ios');\n                if (d) setDate(d);\n              },\n              minimumDate: new Date()\n            })]\n          })]\n        }), selectedBranch && selectedSpecialty && _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Ch\\u1ECDn gi\\u1EDD kh\\xE1m \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), loadingSlots ? _jsx(View, {\n            style: {\n              padding: 20\n            },\n            children: _jsx(ActivityIndicator, {})\n          }) : slotError || !availableSlots || availableSlots.length === 0 ? _jsx(Text, {\n            style: {\n              color: 'orange',\n              fontStyle: 'italic'\n            },\n            children: \"Kh\\xF4ng t\\xECm th\\u1EA5y l\\u1ECBch tr\\u1ED1ng ho\\u1EB7c ng\\xE0y n\\xE0y ph\\xF2ng kh\\xE1m ngh\\u1EC9.\"\n          }) : _jsx(View, {\n            style: styles.slotGrid,\n            children: availableSlots.map(function (slot) {\n              return _jsx(TouchableOpacity, {\n                style: [styles.slotItem, selectedTimeSlot === slot && styles.slotSelected],\n                onPress: function onPress() {\n                  return setSelectedTimeSlot(slot);\n                },\n                children: _jsx(Text, {\n                  style: [styles.slotText, selectedTimeSlot === slot && {\n                    color: 'white',\n                    fontWeight: 'bold'\n                  }],\n                  children: slot\n                })\n              }, slot);\n            })\n          })]\n        }), _jsxs(View, {\n          style: styles.group,\n          children: [_jsxs(Text, {\n            style: styles.label,\n            children: [\"Tri\\u1EC7u ch\\u1EE9ng / L\\xFD do \", _jsx(Text, {\n              style: {\n                color: 'red'\n              },\n              children: \"*\"\n            })]\n          }), _jsx(TextInput, {\n            mode: \"outlined\",\n            placeholder: \"Nh\\u1EADp tri\\u1EC7u ch\\u1EE9ng...\",\n            multiline: true,\n            numberOfLines: 3,\n            value: notes,\n            onChangeText: setNotes,\n            style: {\n              backgroundColor: 'white'\n            }\n          })]\n        }), _jsx(Button, {\n          mode: \"contained\",\n          onPress: handleSubmit,\n          loading: createMutation.isPending,\n          style: {\n            marginTop: 12\n          },\n          contentStyle: {\n            height: 48\n          },\n          disabled: !selectedTimeSlot,\n          children: \"Ti\\u1EBFp t\\u1EE5c\"\n        })]\n      })]\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff'\n  },\n  center: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  header: {\n    padding: 16,\n    backgroundColor: '#f5f5f5',\n    borderBottomWidth: 1,\n    borderColor: '#eee'\n  },\n  formContainer: {\n    padding: 16\n  },\n  group: {\n    marginBottom: 16\n  },\n  label: {\n    marginBottom: 6,\n    fontWeight: '500',\n    color: '#444'\n  },\n  dropdown: {\n    borderWidth: 1,\n    borderColor: '#ddd',\n    borderRadius: 6,\n    padding: 12,\n    backgroundColor: 'white'\n  },\n  disabled: {\n    backgroundColor: '#f2f2f2',\n    borderColor: '#e0e0e0'\n  },\n  row: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center'\n  },\n  slotGrid: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    gap: 10\n  },\n  slotItem: {\n    width: '23%',\n    paddingVertical: 10,\n    borderRadius: 6,\n    borderWidth: 1,\n    borderColor: '#ccc',\n    alignItems: 'center',\n    backgroundColor: '#fff'\n  },\n  slotSelected: {\n    backgroundColor: '#2196F3',\n    borderColor: '#2196F3'\n  },\n  slotText: {\n    color: '#333',\n    fontSize: 14\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","createElement","View","StyleSheet","ScrollView","Platform","KeyboardAvoidingView","Alert","TouchableOpacity","Text","Button","TextInput","useTheme","Menu","TouchableRipple","ActivityIndicator","Banner","ProgressBar","useQuery","useMutation","useQueryClient","DateTimePicker","MaterialCommunityIcons","dayjs","useNavigation","appointmentService","patientService","useAuthStore","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BookingScreen","_myPatientProfile$use","theme","navigation","queryClient","_useAuthStore","user","_useQuery","queryKey","queryFn","getBranches","_useQuery$data","data","branches","_useQuery2","getSpecialties","_useQuery2$data","specialties","_useQuery3","id","_queryFn","_asyncToGenerator","_patient","_res$data","patient","res","getPatients","limit","found","find","p","_p$user","user_id","Error","apply","arguments","enabled","retry","myPatientProfile","isLoadingProfile","isLoading","isProfileError","isError","_useState","_useState2","_slicedToArray","selectedBranch","setSelectedBranch","_useState3","_useState4","selectedSpecialty","setSelectedSpecialty","_useState5","_useState6","selectedDoctor","setSelectedDoctor","_useState7","Date","_useState8","date","setDate","_useState9","_useState0","showDatePicker","setShowDatePicker","_useState1","_useState10","selectedTimeSlot","setSelectedTimeSlot","_useState11","_useState12","notes","setNotes","_useState13","branch","specialty","doctor","_useState14","visibleMenu","setVisibleMenu","_useQuery4","getDoctors","_useQuery4$data","doctors","formattedDate","format","_useQuery5","getAvailableSlots","_useQuery5$data","availableSlots","loadingSlots","isFetching","showAlert","title","message","onOk","OS","window","alert","text","onPress","createMutation","mutationFn","createAppointment","onSuccess","response","invalidateQueries","navigate","onError","err","_err$response","_err$response$data","msg","Array","isArray","handleSubmit","trim","_selectedTimeSlot$spl","split","_selectedTimeSlot$spl2","h","m","startDateTime","hour","Number","minute","second","endDateTime","add","mutate","patient_id","branch_id","doctor_assigned_id","undefined","start_time","toISOString","end_time","appointment_type","source","getBranchName","_branches$find","b","name","getSpecialtyName","_specialties$find","s","getDoctorName","_doctors$find","_doctors$find$user","d","full_name","style","styles","center","children","animating","size","padding","visible","actions","label","behavior","flex","container","contentContainerStyle","paddingBottom","header","variant","fontWeight","color","colors","primary","progress","marginTop","height","borderRadius","formContainer","group","onDismiss","_objectSpread","anchor","dropdown","row","map","Item","disabled","numberOfLines","_d$user","type","value","border","outline","width","fontSize","backgroundColor","fontFamily","onChange","e","target","mode","display","minimumDate","slotError","length","fontStyle","slotGrid","slot","slotItem","slotSelected","slotText","placeholder","multiline","onChangeText","loading","isPending","contentStyle","create","justifyContent","alignItems","borderBottomWidth","borderColor","marginBottom","borderWidth","flexDirection","flexWrap","gap","paddingVertical"],"sources":["D:/Student/N4_HK2/Web_App/clinic-starter/mobile/src/screens/BookingScreen.tsx"],"sourcesContent":["import React, { useState, useEffect, createElement } from 'react';\r\nimport { View, StyleSheet, ScrollView, Platform, KeyboardAvoidingView, Alert, TouchableOpacity } from 'react-native';\r\nimport { Text, Button, TextInput, useTheme, Menu, TouchableRipple, ActivityIndicator, Banner, ProgressBar } from 'react-native-paper';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { MaterialCommunityIcons } from '@expo/vector-icons';\r\nimport dayjs from 'dayjs';\r\nimport { useNavigation } from '@react-navigation/native';\r\n\r\nimport { appointmentService } from '../services/appointment.service';\r\nimport { patientService } from '../services/patient.service';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nexport default function BookingScreen() {\r\n    const theme = useTheme();\r\n    const navigation = useNavigation<any>();\r\n    const queryClient = useQueryClient();\r\n    const { user } = useAuthStore();\r\n\r\n    // --- 1. DATA FETCHING ---\r\n    const { data: branches = [] } = useQuery({ queryKey: ['branches'], queryFn: appointmentService.getBranches });\r\n    const { data: specialties = [] } = useQuery({ queryKey: ['specialties'], queryFn: appointmentService.getSpecialties });\r\n\r\n    // Tìm hồ sơ bệnh nhân\r\n    const { data: myPatientProfile, isLoading: isLoadingProfile, isError: isProfileError } = useQuery({\r\n        queryKey: ['my-patient-profile', user?.id],\r\n        queryFn: async () => {\r\n            if ((user as any)?.patient?.id) return (user as any).patient;\r\n            const res = await patientService.getPatients({ limit: 1000 });\r\n            const found = res.data?.find((p: any) => p.user_id === user?.id || p.user?.id === user?.id);\r\n            if (!found) throw new Error('NOT_FOUND');\r\n            return found;\r\n        },\r\n        enabled: !!user?.id,\r\n        retry: 1\r\n    });\r\n\r\n    // --- 2. FORM STATE ---\r\n    const [selectedBranch, setSelectedBranch] = useState<string>('');\r\n    const [selectedSpecialty, setSelectedSpecialty] = useState<string>('');\r\n    const [selectedDoctor, setSelectedDoctor] = useState<string>('');\r\n    const [date, setDate] = useState(new Date());\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [selectedTimeSlot, setSelectedTimeSlot] = useState<string>('');\r\n    const [notes, setNotes] = useState('');\r\n\r\n    const [visibleMenu, setVisibleMenu] = useState({ branch: false, specialty: false, doctor: false });\r\n\r\n    // Lấy bác sĩ\r\n    const { data: doctors = [] } = useQuery({\r\n        queryKey: ['doctors', selectedBranch, selectedSpecialty],\r\n        queryFn: () => appointmentService.getDoctors(selectedBranch, selectedSpecialty),\r\n        enabled: !!selectedSpecialty,\r\n    });\r\n\r\n    // Lấy Slot (Giờ khám)\r\n    const formattedDate = dayjs(date).format('YYYY-MM-DD');\r\n    const { data: availableSlots = [], isFetching: loadingSlots } = useQuery({\r\n        queryKey: ['slots', selectedBranch, selectedSpecialty, selectedDoctor, formattedDate],\r\n        queryFn: () => appointmentService.getAvailableSlots(selectedBranch, selectedSpecialty, formattedDate, selectedDoctor),\r\n        enabled: !!selectedBranch && !!selectedSpecialty,\r\n        retry: false\r\n    });\r\n\r\n    // Reset logic khi đổi lựa chọn\r\n    useEffect(() => { setSelectedSpecialty(''); setSelectedDoctor(''); setSelectedTimeSlot(''); }, [selectedBranch]);\r\n    useEffect(() => { setSelectedDoctor(''); setSelectedTimeSlot(''); }, [selectedSpecialty]);\r\n    useEffect(() => { setSelectedTimeSlot(''); }, [selectedDoctor, formattedDate]);\r\n\r\n    // --- 3. HELPER: SHOW ALERT (FIX LỖI WEB) ---\r\n    const showAlert = (title: string, message: string, onOk?: () => void) => {\r\n        if (Platform.OS === 'web') {\r\n            // Trên Web dùng window.alert và gọi hàm ngay lập tức\r\n            window.alert(`${title}: ${message}`);\r\n            if (onOk) onOk();\r\n        } else {\r\n            // Trên Mobile dùng Alert Native\r\n            Alert.alert(title, message, [{ text: 'OK', onPress: onOk }]);\r\n        }\r\n    };\r\n\r\n    // --- 4. SUBMIT ---\r\n    const createMutation = useMutation({\r\n        mutationFn: appointmentService.createAppointment,\r\n        onSuccess: (response: any) => {\r\n            const message = response?.message || 'Đặt lịch thành công!';\r\n\r\n            // Gọi hàm Alert đã fix lỗi\r\n            showAlert('Thông báo', message, () => {\r\n                queryClient.invalidateQueries(['myAppointments']);\r\n                navigation.navigate('Appointments');\r\n            });\r\n        },\r\n        onError: (err: any) => {\r\n            const msg = err?.response?.data?.message || 'Có lỗi xảy ra';\r\n            showAlert('Lỗi', Array.isArray(msg) ? msg[0] : msg);\r\n        },\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!selectedBranch) return showAlert('Thiếu thông tin', 'Vui lòng chọn Cơ sở');\r\n        if (!selectedSpecialty) return showAlert('Thiếu thông tin', 'Vui lòng chọn Chuyên khoa');\r\n        if (!selectedTimeSlot) return showAlert('Thiếu thông tin', 'Vui lòng chọn Giờ khám');\r\n        if (!notes.trim()) return showAlert('Thiếu thông tin', 'Vui lòng nhập Triệu chứng/Lý do khám');\r\n\r\n        // Xử lý ngày giờ\r\n        const [h, m] = selectedTimeSlot.split(':');\r\n        const startDateTime = dayjs(date).hour(Number(h)).minute(Number(m)).second(0);\r\n        const endDateTime = startDateTime.add(30, 'minute');\r\n\r\n        createMutation.mutate({\r\n            patient_id: myPatientProfile.id,\r\n            branch_id: selectedBranch,\r\n            doctor_assigned_id: selectedDoctor || undefined,\r\n            start_time: startDateTime.toISOString(),\r\n            end_time: endDateTime.toISOString(),\r\n            notes: notes,\r\n            appointment_type: 'checkup',\r\n            source: 'mobile_app'\r\n        });\r\n    };\r\n\r\n    // Helper hiển thị tên\r\n    const getBranchName = () => Array.isArray(branches) ? branches.find(b => b.id === selectedBranch)?.name || 'Chọn cơ sở' : 'Chọn cơ sở';\r\n    const getSpecialtyName = () => Array.isArray(specialties) ? specialties.find(s => s.id === selectedSpecialty)?.name || 'Tất cả chuyên khoa' : 'Tất cả chuyên khoa';\r\n    const getDoctorName = () => Array.isArray(doctors) ? doctors.find(d => d.id === selectedDoctor)?.user?.full_name || 'Bác sĩ bất kỳ' : 'Bác sĩ bất kỳ';\r\n\r\n    if (isLoadingProfile) return <View style={styles.center}><ActivityIndicator animating size=\"large\" /></View>;\r\n    if (isProfileError || !myPatientProfile) return (\r\n        <View style={{ padding: 16 }}><Banner visible actions={[{ label: 'Cập nhật', onPress: () => navigation.navigate('Profile') }]}>Chưa có hồ sơ bệnh nhân.</Banner></View>\r\n    );\r\n\r\n    return (\r\n        <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined} style={{ flex: 1 }}>\r\n            <ScrollView style={styles.container} contentContainerStyle={{ paddingBottom: 40 }}>\r\n\r\n                {/* Header */}\r\n                <View style={styles.header}>\r\n                    <Text variant=\"titleMedium\" style={{ fontWeight: 'bold', color: theme.colors.primary }}>\r\n                        Đặt lịch: {myPatientProfile.user?.full_name}\r\n                    </Text>\r\n                    <ProgressBar progress={selectedTimeSlot ? 1 : 0.6} color={theme.colors.primary} style={{ marginTop: 8, height: 4, borderRadius: 2 }} />\r\n                </View>\r\n\r\n                <View style={styles.formContainer}>\r\n\r\n                    {/* 1. CƠ SỞ */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Cơ sở khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <Menu\r\n                            visible={visibleMenu.branch}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, branch: false })}\r\n                            anchor={\r\n                                <TouchableRipple onPress={() => setVisibleMenu({ ...visibleMenu, branch: true })} style={styles.dropdown}>\r\n                                    <View style={styles.row}>\r\n                                        <Text>{getBranchName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            {Array.isArray(branches) && branches.map(b => (\r\n                                <Menu.Item key={b.id} onPress={() => { setSelectedBranch(b.id); setVisibleMenu({ ...visibleMenu, branch: false }); }} title={b.name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 2. CHUYÊN KHOA */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Chuyên khoa <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <Menu\r\n                            visible={visibleMenu.specialty}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, specialty: false })}\r\n                            anchor={\r\n                                <TouchableRipple\r\n                                    onPress={() => !selectedBranch ? showAlert('Lưu ý', 'Vui lòng chọn cơ sở trước') : setVisibleMenu({ ...visibleMenu, specialty: true })}\r\n                                    style={[styles.dropdown, !selectedBranch && styles.disabled]}\r\n                                >\r\n                                    <View style={styles.row}>\r\n                                        <Text>{getSpecialtyName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            {Array.isArray(specialties) && specialties.map(s => (\r\n                                <Menu.Item key={s.id} onPress={() => { setSelectedSpecialty(s.id); setVisibleMenu({ ...visibleMenu, specialty: false }); }} title={s.name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 3. BÁC SĨ */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Bác sĩ khám</Text>\r\n                        <Menu\r\n                            visible={visibleMenu.doctor}\r\n                            onDismiss={() => setVisibleMenu({ ...visibleMenu, doctor: false })}\r\n                            anchor={\r\n                                <TouchableRipple\r\n                                    onPress={() => !selectedSpecialty ? showAlert('Lưu ý', 'Vui lòng chọn chuyên khoa trước') : setVisibleMenu({ ...visibleMenu, doctor: true })}\r\n                                    style={[styles.dropdown, !selectedSpecialty && styles.disabled]}\r\n                                >\r\n                                    <View style={styles.row}>\r\n                                        <Text numberOfLines={1} style={{ flex: 1 }}>{getDoctorName()}</Text>\r\n                                        <MaterialCommunityIcons name=\"chevron-down\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                            }\r\n                        >\r\n                            <Menu.Item onPress={() => { setSelectedDoctor(''); setVisibleMenu({ ...visibleMenu, doctor: false }); }} title=\"Chọn bác sĩ trong khoa này (Bất kỳ)\" />\r\n                            {Array.isArray(doctors) && doctors.map(d => (\r\n                                <Menu.Item key={d.id} onPress={() => { setSelectedDoctor(d.id); setVisibleMenu({ ...visibleMenu, doctor: false }); }} title={d.user?.full_name} />\r\n                            ))}\r\n                        </Menu>\r\n                    </View>\r\n\r\n                    {/* 4. NGÀY KHÁM */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Ngày khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        {Platform.OS === 'web' ? (\r\n                            <View style={styles.dropdown}>\r\n                                {createElement('input', {\r\n                                    type: 'date',\r\n                                    value: dayjs(date).format('YYYY-MM-DD'),\r\n                                    style: { border: 'none', outline: 'none', width: '100%', fontSize: 16, backgroundColor: 'transparent', fontFamily: 'System' },\r\n                                    onChange: (e: any) => setDate(new Date(e.target.value))\r\n                                })}\r\n                            </View>\r\n                        ) : (\r\n                            <>\r\n                                <TouchableRipple onPress={() => setShowDatePicker(true)} style={styles.dropdown}>\r\n                                    <View style={styles.row}>\r\n                                        <Text>{dayjs(date).format('DD/MM/YYYY')}</Text>\r\n                                        <MaterialCommunityIcons name=\"calendar\" size={24} color=\"#777\" />\r\n                                    </View>\r\n                                </TouchableRipple>\r\n                                {showDatePicker && (\r\n                                    <DateTimePicker\r\n                                        value={date} mode=\"date\" display={Platform.OS === 'ios' ? 'spinner' : 'default'}\r\n                                        onChange={(e, d) => { setShowDatePicker(Platform.OS === 'ios'); if (d) setDate(d); }}\r\n                                        minimumDate={new Date()}\r\n                                    />\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </View>\r\n\r\n                    {/* 5. GIỜ KHÁM (SLOTS) */}\r\n                    {selectedBranch && selectedSpecialty && (\r\n                        <View style={styles.group}>\r\n                            <Text style={styles.label}>Chọn giờ khám <Text style={{ color: 'red' }}>*</Text></Text>\r\n\r\n                            {loadingSlots ? (\r\n                                <View style={{ padding: 20 }}><ActivityIndicator /></View>\r\n                            ) : (slotError || !availableSlots || availableSlots.length === 0) ? (\r\n                                <Text style={{ color: 'orange', fontStyle: 'italic' }}>\r\n                                    Không tìm thấy lịch trống hoặc ngày này phòng khám nghỉ.\r\n                                </Text>\r\n                            ) : (\r\n                                <View style={styles.slotGrid}>\r\n                                    {availableSlots.map((slot: string) => (\r\n                                        <TouchableOpacity\r\n                                            key={slot}\r\n                                            style={[\r\n                                                styles.slotItem,\r\n                                                selectedTimeSlot === slot && styles.slotSelected\r\n                                            ]}\r\n                                            onPress={() => setSelectedTimeSlot(slot)}\r\n                                        >\r\n                                            <Text style={[\r\n                                                styles.slotText,\r\n                                                selectedTimeSlot === slot && { color: 'white', fontWeight: 'bold' }\r\n                                            ]}>\r\n                                                {slot}\r\n                                            </Text>\r\n                                        </TouchableOpacity>\r\n                                    ))}\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n                    )}\r\n\r\n                    {/* 6. TRIỆU CHỨNG */}\r\n                    <View style={styles.group}>\r\n                        <Text style={styles.label}>Triệu chứng / Lý do <Text style={{ color: 'red' }}>*</Text></Text>\r\n                        <TextInput\r\n                            mode=\"outlined\"\r\n                            placeholder=\"Nhập triệu chứng...\"\r\n                            multiline numberOfLines={3}\r\n                            value={notes} onChangeText={setNotes}\r\n                            style={{ backgroundColor: 'white' }}\r\n                        />\r\n                    </View>\r\n\r\n                    {/* SUBMIT BUTTON */}\r\n                    <Button\r\n                        mode=\"contained\"\r\n                        onPress={handleSubmit}\r\n                        loading={createMutation.isPending}\r\n                        style={{ marginTop: 12 }}\r\n                        contentStyle={{ height: 48 }}\r\n                        disabled={!selectedTimeSlot} // Chỉ cho phép bấm khi đã chọn giờ\r\n                    >\r\n                        Tiếp tục\r\n                    </Button>\r\n\r\n                </View>\r\n            </ScrollView>\r\n        </KeyboardAvoidingView>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#fff' },\r\n    center: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n    header: { padding: 16, backgroundColor: '#f5f5f5', borderBottomWidth: 1, borderColor: '#eee' },\r\n    formContainer: { padding: 16 },\r\n    group: { marginBottom: 16 },\r\n    label: { marginBottom: 6, fontWeight: '500', color: '#444' },\r\n    dropdown: { borderWidth: 1, borderColor: '#ddd', borderRadius: 6, padding: 12, backgroundColor: 'white' },\r\n    disabled: { backgroundColor: '#f2f2f2', borderColor: '#e0e0e0' },\r\n    row: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' },\r\n    slotGrid: { flexDirection: 'row', flexWrap: 'wrap', gap: 10 },\r\n    slotItem: {\r\n        width: '23%',\r\n        paddingVertical: 10,\r\n        borderRadius: 6,\r\n        borderWidth: 1,\r\n        borderColor: '#ccc',\r\n        alignItems: 'center',\r\n        backgroundColor: '#fff',\r\n    },\r\n    slotSelected: {\r\n        backgroundColor: '#2196F3',\r\n        borderColor: '#2196F3',\r\n    },\r\n    slotText: {\r\n        color: '#333',\r\n        fontSize: 14,\r\n    }\r\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}